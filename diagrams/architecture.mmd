graph LR
    %% Entry
    User([User]) --> CLI[CLI]
    Config[Config] --> CLI

    %% Ingestion
    CLI --> Parse[Parse Trace]
    Parse --> Format{Format}
    Format --> Parser[Parser]
    Parser --> Normalize[Normalize]

    %% Pre-analysis
    Normalize --> PreAnalysis[Pre-Analysis]
    PreAnalysis --> Patterns[Patterns]
    Patterns --> Signals[Signals]

    %% Decision
    Signals --> Decision{Mode?}

    %% Deterministic path
    Decision -->|No LLM| Det[Deterministic]

    %% LLM path
    Decision -->|LLM| LLM[LLM Agent]
    LLM --> API[OpenRouter]
    API --> LLM

    %% Output
    LLM --> Result[Result]
    Det --> Result
    Result --> Report[Report]
    Signals --> Artifacts[Artifacts]

    %% Styling
    classDef entry fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef analysis fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef output fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef decision fill:#ffebee,stroke:#d32f2f,stroke-width:3px

    class User,CLI,Config entry
    class Parse,Format,Parser,Normalize,PreAnalysis,Patterns,Signals process
    class Decision decision
    class Det,LLM,API,Result analysis
    class Report,Artifacts output
